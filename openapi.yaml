yaml:backend/openapi.yaml
openapi: 3.1.0
info:
  title: Watch Service Center API
  description: |
    RESTful API for managing a watch service center. This API provides endpoints for:
    - Authentication and user management
    - Customer and supplier management
    - Job lifecycle (booking, indenting, completion, delivery)
    - Watch management with complaints and conditions
    - File attachments
    - Audit trail
    - Global search
  version: 1.0.0
  contact:
    name: Watch Service Center
    email: support@watchservice.com

servers:
  - url: /api/v1
    description: API v1

tags:
  - name: auth
    description: Authentication endpoints
  - name: customers
    description: Customer management
  - name: suppliers
    description: Supplier management
  - name: brands
    description: Brand management
  - name: jobs
    description: Job/Order management
  - name: watches
    description: Watch management
  - name: indents
    description: Indent (parts order) management
  - name: spare_parts
    description: Spare parts management
  - name: complaints
    description: Complaint nodes and watch complaints
  - name: conditions
    description: Condition nodes and watch conditions
  - name: attachments
    description: File attachments for watches, complaints, and conditions
  - name: audit
    description: Audit trail and history
  - name: search
    description: Global search functionality

security:
  - BearerAuth: []

paths:
  # ===========================================================================
  # AUTH ENDPOINTS
  # ===========================================================================
  /auth/login:
    post:
      tags:
        - auth
      summary: User login
      description: Authenticate user and return JWT token
      operationId: login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Successful authentication
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Token'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/me:
    get:
      tags:
        - auth
      summary: Get current user info
      description: Get current authenticated user's profile information
      operationId: getCurrentUser
      responses:
        '200':
          description: User profile data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRead'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ===========================================================================
  # CUSTOMER ENDPOINTS
  # ===========================================================================
  /customers:
    post:
      tags:
        - customers
      summary: Create a new customer
      operationId: createCustomer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerCreate'
      responses:
        '201':
          description: Customer created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerRead'
        '409':
          description: Customer with same contact number already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - customers
      summary: List all customers
      operationId: listCustomers
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: search
          in: query
          description: Search by name, contact, or email
          schema:
            type: string
      responses:
        '200':
          description: Paginated list of customers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedCustomerList'

  /customers/{customer_id}:
    get:
      tags:
        - customers
      summary: Get a specific customer
      operationId: getCustomer
      parameters:
        - $ref: '#/components/parameters/CustomerId'
      responses:
        '200':
          description: Customer details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerRead'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - customers
      summary: Update a customer
      operationId: updateCustomer
      parameters:
        - $ref: '#/components/parameters/CustomerId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CustomerUpdate'
      responses:
        '200':
          description: Customer updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerRead'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Contact number conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - customers
      summary: Delete a customer (soft delete)
      description: Requires manager or admin privileges
      operationId: deleteCustomer
      parameters:
        - $ref: '#/components/parameters/CustomerId'
      responses:
        '204':
          description: Customer deleted successfully
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ===========================================================================
  # SUPPLIER ENDPOINTS
  # ===========================================================================
  /suppliers:
    post:
      tags:
        - suppliers
      summary: Create a new supplier
      operationId: createSupplier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SupplierCreate'
      responses:
        '201':
          description: Supplier created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupplierRead'
        '409':
          description: Supplier with same name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - suppliers
      summary: List all suppliers
      operationId: listSuppliers
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: search
          in: query
          description: Search by name
          schema:
            type: string
      responses:
        '200':
          description: Paginated list of suppliers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedSupplierList'

  /suppliers/all:
    get:
      tags:
        - suppliers
      summary: Get all active suppliers (for dropdowns)
      operationId: getAllSuppliers
      responses:
        '200':
          description: List of all active suppliers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SupplierList'

  /suppliers/{supplier_id}:
    get:
      tags:
        - suppliers
      summary: Get a specific supplier
      operationId: getSupplier
      parameters:
        - $ref: '#/components/parameters/SupplierId'
      responses:
        '200':
          description: Supplier details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupplierRead'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - suppliers
      summary: Update a supplier
      operationId: updateSupplier
      parameters:
        - $ref: '#/components/parameters/SupplierId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SupplierUpdate'
      responses:
        '200':
          description: Supplier updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupplierRead'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Name conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - suppliers
      summary: Delete a supplier (soft delete)
      description: Requires manager or admin privileges
      operationId: deleteSupplier
      parameters:
        - $ref: '#/components/parameters/SupplierId'
      responses:
        '204':
          description: Supplier deleted successfully
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ===========================================================================
  # BRAND ENDPOINTS
  # ===========================================================================
  /brands:
    post:
      tags:
        - brands
      summary: Create a new brand
      operationId: createBrand
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BrandCreate'
      responses:
        '201':
          description: Brand created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrandRead'
        '409':
          description: Brand with same name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - brands
      summary: List all brands
      operationId: listBrands
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: search
          in: query
          description: Search by name
          schema:
            type: string
      responses:
        '200':
          description: Paginated list of brands
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedBrandList'

  /brands/all:
    get:
      tags:
        - brands
      summary: Get all active brands (for dropdowns)
      operationId: getAllBrands
      responses:
        '200':
          description: List of all active brands
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BrandList'

  /brands/{brand_id}:
    get:
      tags:
        - brands
      summary: Get a specific brand
      operationId: getBrand
      parameters:
        - $ref: '#/components/parameters/BrandId'
      responses:
        '200':
          description: Brand details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrandRead'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - brands
      summary: Update a brand
      operationId: updateBrand
      parameters:
        - $ref: '#/components/parameters/BrandId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BrandUpdate'
      responses:
        '200':
          description: Brand updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrandRead'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Name conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - brands
      summary: Delete a brand (soft delete)
      description: Requires manager or admin privileges
      operationId: deleteBrand
      parameters:
        - $ref: '#/components/parameters/BrandId'
      responses:
        '204':
          description: Brand deleted successfully
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ===========================================================================
  # JOB ENDPOINTS
  # ===========================================================================
  /jobs:
    post:
      tags:
        - jobs
      summary: Create a new job
      operationId: createJob
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobCreate'
      responses:
        '201':
          description: Job created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobRead'

    get:
      tags:
        - jobs
      summary: List all jobs
      operationId: listJobs
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: status
          in: query
          description: Filter by status
          schema:
            $ref: '#/components/schemas/JobStatus'
        - name: customer_id
          in: query
          description: Filter by customer ID
          schema:
            type: integer
        - name: search
          in: query
          description: Search by job number or notes
          schema:
            type: string
      responses:
        '200':
          description: Paginated list of jobs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedJobList'

  /jobs/{job_id}:
    get:
      tags:
        - jobs
      summary: Get a specific job
      operationId: getJob
      parameters:
        - $ref: '#/components/parameters/JobId'
      responses:
        '200':
          description: Job details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobRead'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - jobs
      summary: Update a job
      operationId: updateJob
      parameters:
        - $ref: '#/components/parameters/JobId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobUpdate'
      responses:
        '200':
          description: Job updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobRead'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - jobs
      summary: Delete a job (soft delete)
      description: Requires manager or admin privileges
      operationId: deleteJob
      parameters:
        - $ref: '#/components/parameters/JobId'
      responses:
        '204':
          description: Job deleted successfully
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /jobs/{job_id}/status:
    post:
      tags:
        - jobs
      summary: Update job status
      description: Update job status with validation and lifecycle timestamp updates
      operationId: updateJobStatus
      parameters:
        - $ref: '#/components/parameters/JobId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobStatusUpdate'
      responses:
        '200':
          description: Job status updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobRead'
        '400':
          description: Invalid status transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /jobs/{job_id}/delay:
    post:
      tags:
        - jobs
      summary: Add delay to a job
      description: |
        Record a delay reason and update estimated delivery date.
        Requires manager or admin privileges.
      operationId: addJobDelay
      parameters:
        - $ref: '#/components/parameters/JobId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobDelayCreate'
      responses:
        '200':
          description: Delay recorded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobRead'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ===========================================================================
  # WATCH ENDPOINTS
  # ===========================================================================
  /watches:
    post:
      tags:
        - watches
      summary: Create a new watch
      description: A job can only have one watch (one-to-one relationship)
      operationId: createWatch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WatchCreate'
      responses:
        '201':
          description: Watch created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchRead'
        '400':
          description: Job already has a watch
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - watches
      summary: List all watches
      operationId: listWatches
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: brand_id
          in: query
          description: Filter by brand ID
          schema:
            type: integer
        - name: search
          in: query
          description: Search by model or serial number
          schema:
            type: string
      responses:
        '200':
          description: Paginated list of watches
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedWatchList'

  /watches/{watch_id}:
    get:
      tags:
        - watches
      summary: Get a specific watch
      operationId: getWatch
      parameters:
        - $ref: '#/components/parameters/WatchId'
      responses:
        '200':
          description: Watch details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchRead'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - watches
      summary: Update a watch
      operationId: updateWatch
      parameters:
        - $ref: '#/components/parameters/WatchId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WatchUpdate'
      responses:
        '200':
          description: Watch updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchRead'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - watches
      summary: Delete a watch (soft delete)
      description: Requires manager or admin privileges
      operationId: deleteWatch
      parameters:
        - $ref: '#/components/parameters/WatchId'
      responses:
        '204':
          description: Watch deleted successfully
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /watches/job/{job_id}:
    get:
      tags:
        - watches
      summary: Get watch by job ID
      description: Since job-watch is one-to-one, returns a single watch
      operationId: getWatchByJob
      parameters:
        - $ref: '#/components/parameters/JobId'
      responses:
        '200':
          description: Watch details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchRead'
        '404':
          $ref: '#/components/responses/NotFound'

  # ===========================================================================
  # INDENT ENDPOINTS
  # ===========================================================================
  /indents:
    post:
      tags:
        - indents
      summary: Create a new indent
      description: Serial number is auto-generated
      operationId: createIndent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IndentCreate'
      responses:
        '201':
          description: Indent created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IndentRead'

    get:
      tags:
        - indents
      summary: List all indents
      operationId: listIndents
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: job_id
          in: query
          description: Filter by job ID
          schema:
            type: integer
        - name: supplier_id
          in: query
          description: Filter by supplier ID
          schema:
            type: integer
      responses:
        '200':
          description: Paginated list of indents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedIndentList'

  /indents/{indent_id}:
    get:
      tags:
        - indents
      summary: Get a specific indent
      operationId: getIndent
      parameters:
        - $ref: '#/components/parameters/IndentId'
      responses:
        '200':
          description: Indent details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IndentRead'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - indents
      summary: Update an indent
      operationId: updateIndent
      parameters:
        - $ref: '#/components/parameters/IndentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IndentUpdate'
      responses:
        '200':
          description: Indent updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IndentRead'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - indents
      summary: Delete an indent (soft delete)
      description: Requires manager or admin privileges
      operationId: deleteIndent
      parameters:
        - $ref: '#/components/parameters/IndentId'
      responses:
        '204':
          description: Indent deleted successfully
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ===========================================================================
  # SPARE PARTS ENDPOINTS
  # ===========================================================================
  /spare-parts:
    post:
      tags:
        - spare_parts
      summary: Create a new spare part
      operationId: createSparePart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SparePartCreate'
      responses:
        '201':
          description: Spare part created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SparePartRead'

    get:
      tags:
        - spare_parts
      summary: List all spare parts
      operationId: listSpareParts
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: indent_id
          in: query
          description: Filter by indent ID
          schema:
            type: integer
        - name: search
          in: query
          description: Search by part name
          schema:
            type: string
      responses:
        '200':
          description: Paginated list of spare parts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedSparePartList'

  /spare-parts/{spare_part_id}:
    get:
      tags:
        - spare_parts
      summary: Get a specific spare part
      operationId: getSparePart
      parameters:
        - $ref: '#/components/parameters/SparePartId'
      responses:
        '200':
          description: Spare part details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SparePartRead'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - spare_parts
      summary: Update a spare part
      operationId: updateSparePart
      parameters:
        - $ref: '#/components/parameters/SparePartId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SparePartUpdate'
      responses:
        '200':
          description: Spare part updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SparePartRead'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - spare_parts
      summary: Delete a spare part (soft delete)
      description: Requires manager or admin privileges
      operationId: deleteSparePart
      parameters:
        - $ref: '#/components/parameters/SparePartId'
      responses:
        '204':
          description: Spare part deleted successfully
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ===========================================================================
  # COMPLAINT NODE ENDPOINTS
  # ===========================================================================
  /complaints/nodes:
    post:
      tags:
        - complaints
      summary: Create a complaint node (admin only)
      operationId: createComplaintNode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComplaintNodeCreate'
      responses:
        '201':
          description: Complaint node created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComplaintNodeRead'
        '400':
          description: Duplicate code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Parent node not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - complaints
      summary: List complaint nodes as tree
      operationId: listComplaintNodes
      parameters:
        - name: available_only
          in: query
          description: Only return currently available nodes
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Tree structure of complaint nodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ComplaintNodeList'

  /complaints/nodes/search:
    get:
      tags:
        - complaints
      summary: Search complaint nodes
      operationId: searchComplaintNodes
      parameters:
        - name: q
          in: query
          required: true
          description: Search query
          schema:
            type: string
        - name: available_only
          in: query
          description: Only return currently available nodes
          schema:
            type: boolean
            default: true
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: List of matching complaint nodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ComplaintNodeRead'

  /complaints/nodes/{node_id}:
    get:
      tags:
        - complaints
      summary: Get a complaint node
      operationId: getComplaintNode
      parameters:
        - $ref: '#/components/parameters/NodeId'
      responses:
        '200':
          description: Complaint node details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComplaintNodeRead'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - complaints
      summary: Update a complaint node (admin only)
      operationId: updateComplaintNode
      parameters:
        - $ref: '#/components/parameters/NodeId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComplaintNodeUpdate'
      responses:
        '200':
          description: Complaint node updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComplaintNodeRead'
        '400':
          description: Cannot be own parent or duplicate code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - complaints
      summary: Delete a complaint node (admin only)
      operationId: deleteComplaintNode
      parameters:
        - $ref: '#/components/parameters/NodeId'
      responses:
        '204':
          description: Complaint node deleted successfully
        '400':
          description: Cannot delete node with available children
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ===========================================================================
  # WATCH COMPLAINT ENDPOINTS
  # ===========================================================================
  /complaints/watch-complaints:
    post:
      tags:
        - complaints
      summary: Attach a complaint to a watch
      operationId: attachComplaintToWatch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WatchComplaintCreate'
      responses:
        '201':
          description: Complaint attached successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchComplaintRead'
        '400':
          description: Complaint already attached or node unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /complaints/watch-complaints/batch:
    post:
      tags:
        - complaints
      summary: Attach multiple complaints to a watch
      operationId: attachComplaintsBatch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WatchComplaintBatchCreate'
      responses:
        '201':
          description: Complaints attached successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WatchComplaintRead'
        '404':
          $ref: '#/components/responses/NotFound'

  /complaints/watch-complaints/watch/{watch_id}:
    get:
      tags:
        - complaints
      summary: Get all complaints for a watch
      operationId: getWatchComplaints
      parameters:
        - $ref: '#/components/parameters/WatchId'
      responses:
        '200':
          description: List of watch complaints
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WatchComplaintRead'
        '404':
          $ref: '#/components/responses/NotFound'

  /complaints/watch-complaints/{complaint_id}:
    get:
      tags:
        - complaints
      summary: Get a specific watch complaint
      operationId: getWatchComplaint
      parameters:
        - $ref: '#/components/parameters/ComplaintId'
      responses:
        '200':
          description: Watch complaint details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchComplaintRead'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - complaints
      summary: Update a watch complaint
      operationId: updateWatchComplaint
      parameters:
        - $ref: '#/components/parameters/ComplaintId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WatchComplaintUpdate'
      responses:
        '200':
          description: Watch complaint updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchComplaintRead'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - complaints
      summary: Detach a complaint from a watch
      operationId: detachComplaintFromWatch
      parameters:
        - $ref: '#/components/parameters/ComplaintId'
      responses:
        '204':
          description: Complaint detached successfully
        '404':
          $ref: '#/components/responses/NotFound'

  /complaints/watch-complaints/watch/{watch_id}/all:
    delete:
      tags:
        - complaints
      summary: Detach all complaints from a watch
      operationId: detachAllComplaintsFromWatch
      parameters:
        - $ref: '#/components/parameters/WatchId'
      responses:
        '200':
          description: All complaints detached
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  count:
                    type: integer
        '404':
          $ref: '#/components/responses/NotFound'

  # ===========================================================================
  # CONDITION NODE ENDPOINTS
  # ===========================================================================
  /conditions/nodes:
    post:
      tags:
        - conditions
      summary: Create a condition node (admin only)
      operationId: createConditionNode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConditionNodeCreate'
      responses:
        '201':
          description: Condition node created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConditionNodeRead'
        '400':
          description: Duplicate code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Parent node not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - conditions
      summary: List condition nodes as tree
      operationId: listConditionNodes
      parameters:
        - name: available_only
          in: query
          description: Only return currently available nodes
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Tree structure of condition nodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ConditionNodeList'

  /conditions/nodes/search:
    get:
      tags:
        - conditions
      summary: Search condition nodes
      operationId: searchConditionNodes
      parameters:
        - name: q
          in: query
          required: true
          description: Search query
          schema:
            type: string
        - name: available_only
          in: query
          description: Only return currently available nodes
          schema:
            type: boolean
            default: true
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: List of matching condition nodes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ConditionNodeRead'

  /conditions/nodes/{node_id}:
    get:
      tags:
        - conditions
      summary: Get a condition node
      operationId: getConditionNode
      parameters:
        - $ref: '#/components/parameters/NodeId'
      responses:
        '200':
          description: Condition node details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConditionNodeRead'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - conditions
      summary: Update a condition node (admin only)
      operationId: updateConditionNode
      parameters:
        - $ref: '#/components/parameters/NodeId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConditionNodeUpdate'
      responses:
        '200':
          description: Condition node updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConditionNodeRead'
        '400':
          description: Cannot be own parent or duplicate code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - conditions
      summary: Delete a condition node (admin only)
      operationId: deleteConditionNode
      parameters:
        - $ref: '#/components/parameters/NodeId'
      responses:
        '204':
          description: Condition node deleted successfully
        '400':
          description: Cannot delete node with available children
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ===========================================================================
  # WATCH CONDITION ENDPOINTS
  # ===========================================================================
  /conditions/watch-conditions:
    post:
      tags:
        - conditions
      summary: Attach a condition to a watch
      operationId: attachConditionToWatch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WatchConditionCreate'
      responses:
        '201':
          description: Condition attached successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchConditionRead'
        '400':
          description: Condition already attached or node unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /conditions/watch-conditions/batch:
    post:
      tags:
        - conditions
      summary: Attach multiple conditions to a watch
      operationId: attachConditionsBatch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WatchConditionBatchCreate'
      responses:
        '201':
          description: Conditions attached successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WatchConditionRead'
        '404':
          $ref: '#/components/responses/NotFound'

  /conditions/watch-conditions/watch/{watch_id}:
    get:
      tags:
        - conditions
      summary: Get all conditions for a watch
      operationId: getWatchConditions
      parameters:
        - $ref: '#/components/parameters/WatchId'
      responses:
        '200':
          description: List of watch conditions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WatchConditionRead'
        '404':
          $ref: '#/components/responses/NotFound'

  /conditions/watch-conditions/{condition_id}:
    get:
      tags:
        - conditions
      summary: Get a specific watch condition
      operationId: getWatchCondition
      parameters:
        - $ref: '#/components/parameters/ConditionId'
      responses:
        '200':
          description: Watch condition details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchConditionRead'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - conditions
      summary: Update a watch condition
      operationId: updateWatchCondition
      parameters:
        - $ref: '#/components/parameters/ConditionId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WatchConditionUpdate'
      responses:
        '200':
          description: Watch condition updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchConditionRead'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - conditions
      summary: Detach a condition from a watch
      operationId: detachConditionFromWatch
      parameters:
        - $ref: '#/components/parameters/ConditionId'
      responses:
        '204':
          description: Condition detached successfully
        '404':
          $ref: '#/components/responses/NotFound'

  /conditions/watch-conditions/watch/{watch_id}/all:
    delete:
      tags:
        - conditions
      summary: Detach all conditions from a watch
      operationId: detachAllConditionsFromWatch
      parameters:
        - $ref: '#/components/parameters/WatchId'
      responses:
        '200':
          description: All conditions detached
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  count:
                    type: integer
        '404':
          $ref: '#/components/responses/NotFound'

  # ===========================================================================
  # ATTACHMENT ENDPOINTS
  # ===========================================================================
  /watches/{watch_id}/attachments:
    post:
      tags:
        - attachments
      summary: Upload a watch attachment
      description: |
        Upload an attachment for a watch.
        Allowed file types: JPEG, PNG, WebP, GIF, PDF
        Maximum file size: 10 MB
      operationId: uploadWatchAttachment
      parameters:
        - $ref: '#/components/parameters/WatchId'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
              required:
                - file
      responses:
        '201':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentUploadResponse'
        '400':
          description: Invalid file type or size
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'

    get:
      tags:
        - attachments
      summary: List watch attachments
      operationId: listWatchAttachments
      parameters:
        - $ref: '#/components/parameters/WatchId'
        - name: skip
          in: query
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: List of watch attachments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WatchAttachmentList'

  /attachments/watch/{attachment_id}:
    get:
      tags:
        - attachments
      summary: Download a watch attachment
      operationId: downloadWatchAttachment
      parameters:
        - $ref: '#/components/parameters/AttachmentId'
      responses:
        '200':
          description: File download
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - attachments
      summary: Delete a watch attachment
      description: Requires manager or admin role
      operationId: deleteWatchAttachment
      parameters:
        - $ref: '#/components/parameters/AttachmentId'
      responses:
        '204':
          description: Attachment deleted successfully
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /attachments/watch/{attachment_id}/info:
    get:
      tags:
        - attachments
      summary: Get watch attachment metadata
      operationId: getWatchAttachmentInfo
      parameters:
        - $ref: '#/components/parameters/AttachmentId'
      responses:
        '200':
          description: Attachment metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchAttachmentRead'
        '404':
          $ref: '#/components/responses/NotFound'

  /watches/complaints/{complaint_id}/attachments:
    post:
      tags:
        - attachments
      summary: Upload a complaint attachment
      operationId: uploadComplaintAttachment
      parameters:
        - $ref: '#/components/parameters/ComplaintId'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
              required:
                - file
      responses:
        '201':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentUploadResponse'
        '400':
          description: Invalid file type or size
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'

    get:
      tags:
        - attachments
      summary: List complaint attachments
      operationId: listComplaintAttachments
      parameters:
        - $ref: '#/components/parameters/ComplaintId'
        - name: skip
          in: query
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: List of complaint attachments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WatchComplaintAttachmentList'

  /attachments/complaint/{attachment_id}:
    get:
      tags:
        - attachments
      summary: Download a complaint attachment
      operationId: downloadComplaintAttachment
      parameters:
        - $ref: '#/components/parameters/AttachmentId'
      responses:
        '200':
          description: File download
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - attachments
      summary: Delete a complaint attachment
      description: Requires manager or admin role
      operationId: deleteComplaintAttachment
      parameters:
        - $ref: '#/components/parameters/AttachmentId'
      responses:
        '204':
          description: Attachment deleted successfully
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /attachments/complaint/{attachment_id}/info:
    get:
      tags:
        - attachments
      summary: Get complaint attachment metadata
      operationId: getComplaintAttachmentInfo
      parameters:
        - $ref: '#/components/parameters/AttachmentId'
      responses:
        '200':
          description: Attachment metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchComplaintAttachmentRead'
        '404':
          $ref: '#/components/responses/NotFound'

  /watches/conditions/{condition_id}/attachments:
    post:
      tags:
        - attachments
      summary: Upload a condition attachment
      operationId: uploadConditionAttachment
      parameters:
        - $ref: '#/components/parameters/ConditionId'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
              required:
                - file
      responses:
        '201':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttachmentUploadResponse'
        '400':
          description: Invalid file type or size
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'

    get:
      tags:
        - attachments
      summary: List condition attachments
      operationId: listConditionAttachments
      parameters:
        - $ref: '#/components/parameters/ConditionId'
        - name: skip
          in: query
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: List of condition attachments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WatchConditionAttachmentList'

  /attachments/condition/{attachment_id}:
    get:
      tags:
        - attachments
      summary: Download a condition attachment
      operationId: downloadConditionAttachment
      parameters:
        - $ref: '#/components/parameters/AttachmentId'
      responses:
        '200':
          description: File download
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - attachments
      summary: Delete a condition attachment
      description: Requires manager or admin role
      operationId: deleteConditionAttachment
      parameters:
        - $ref: '#/components/parameters/AttachmentId'
      responses:
        '204':
          description: Attachment deleted successfully
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /attachments/condition/{attachment_id}/info:
    get:
      tags:
        - attachments
      summary: Get condition attachment metadata
      operationId: getConditionAttachmentInfo
      parameters:
        - $ref: '#/components/parameters/AttachmentId'
      responses:
        '200':
          description: Attachment metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WatchConditionAttachmentRead'
        '404':
          $ref: '#/components/responses/NotFound'

  # ===========================================================================
  # AUDIT ENDPOINTS
  # ===========================================================================
  /audit:
    get:
      tags:
        - audit
      summary: Search audit events (admin only)
      operationId: searchAuditEvents
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: entity_type
          in: query
          description: Filter by entity type
          schema:
            type: string
        - name: entity_id
          in: query
          description: Filter by entity ID
          schema:
            type: integer
        - name: user_id
          in: query
          description: Filter by user ID
          schema:
            type: integer
        - name: action
          in: query
          description: Filter by action type
          schema:
            type: string
            enum: [create, update, delete, status_change, login, logout, restore, export, import]
      responses:
        '200':
          description: List of audit events
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditEvent'
        '403':
          $ref: '#/components/responses/Forbidden'

  /audit/my-actions:
    get:
      tags:
        - audit
      summary: Get current user's action history
      operationId: getMyAuditActions
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: List of user's audit events
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditEvent'

  /audit/jobs/{job_id}/history:
    get:
      tags:
        - audit
      summary: Get job audit history (manager/admin)
      operationId: getJobAuditHistory
      parameters:
        - $ref: '#/components/parameters/JobId'
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: Job audit history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditEvent'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /audit/indents/{indent_id}/history:
    get:
      tags:
        - audit
      summary: Get indent audit history (manager/admin)
      operationId: getIndentAuditHistory
      parameters:
        - $ref: '#/components/parameters/IndentId'
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: Indent audit history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditEvent'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /audit/users/{user_id}/actions:
    get:
      tags:
        - audit
      summary: Get user's actions (admin only)
      operationId: getUserAuditActions
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: integer
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200':
          description: User's audit events
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditEvent'
        '403':
          $ref: '#/components/responses/Forbidden'

  # ===========================================================================
  # SEARCH ENDPOINTS
  # ===========================================================================
  /search:
    get:
      tags:
        - search
      summary: Global search across entities
      description: |
        Search across multiple entity types:
        - customer: Search by name, contact, email, address, city
        - job: Search by job number, notes, customer name, brand name
        - watch: Search by model, serial number, brand, remarks
        - supplier: Search by name, contact, email, address
        - brand: Search by name, description
      operationId: searchEntities
      parameters:
        - name: q
          in: query
          required: true
          description: Search query (minimum 2 characters)
          schema:
            type: string
            minLength: 2
        - name: entities
          in: query
          description: Comma-separated entity types (customer,job,watch,supplier,brand)
          schema:
            type: string
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PageSize'
        - name: sort_by
          in: query
          description: Sort order
          schema:
            type: string
            enum: [relevance, date]
            default: relevance
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
        '400':
          description: Invalid search query or entity type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

# ===========================================================================
# COMPONENTS
# ===========================================================================
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from /auth/login

  parameters:
    Page:
      name: page
      in: query
      description: Page number (1-indexed)
      schema:
        type: integer
        minimum: 1
        default: 1

    PageSize:
      name: page_size
      in: query
      description: Items per page (max 100)
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

    CustomerId:
      name: customer_id
      in: path
      required: true
      schema:
        type: integer

    SupplierId:
      name: supplier_id
      in: path
      required: true
      schema:
        type: integer

    BrandId:
      name: brand_id
      in: path
      required: true
      schema:
        type: integer

    JobId:
      name: job_id
      in: path
      required: true
      schema:
        type: integer

    WatchId:
      name: watch_id
      in: path
      required: true
      schema:
        type: integer

    IndentId:
      name: indent_id
      in: path
      required: true
      schema:
        type: integer

    SparePartId:
      name: spare_part_id
      in: path
      required: true
      schema:
        type: integer

    NodeId:
      name: node_id
      in: path
      required: true
      schema:
        type: integer

    ComplaintId:
      name: complaint_id
      in: path
      required: true
      schema:
        type: integer

    ConditionId:
      name: condition_id
      in: path
      required: true
      schema:
        type: integer

    AttachmentId:
      name: attachment_id
      in: path
      required: true
      schema:
        type: integer

  responses:
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    # ===========================================================================
    # AUTH SCHEMAS
    # ===========================================================================
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
        password:
          type: string

    Token:
      type: object
      properties:
        access_token:
          type: string
        token_type:
          type: string
          default: bearer
        expires_in:
          type: integer
          description: Token expiration time in seconds

    # ===========================================================================
    # USER SCHEMAS
    # ===========================================================================
    UserRead:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
          minLength: 3
          maxLength: 100
        email:
          type: string
          format: email
        full_name:
          type: string
          nullable: true
        is_active:
          type: boolean
        is_manager:
          type: boolean
        is_admin:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # ===========================================================================
    # CUSTOMER SCHEMAS
    # ===========================================================================
    CustomerCreate:
      type: object
      required:
        - name
        - contact_number
        - address
        - city
        - state
        - country
        - postal_code
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
        contact_number:
          type: string
          minLength: 1
          maxLength: 20
        address:
          type: string
          minLength: 1
        city:
          type: string
          minLength: 1
        state:
          type: string
          minLength: 1
        country:
          type: string
          minLength: 1
        postal_code:
          type: string
          minLength: 1
        email:
          type: string
          format: email
          nullable: true
        date_of_birth:
          type: string
          format: date
          nullable: true
        gender:
          type: string
          maxLength: 50
          nullable: true

    CustomerUpdate:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          nullable: true
        contact_number:
          type: string
          minLength: 1
          maxLength: 20
          nullable: true
        address:
          type: string
          minLength: 1
          nullable: true
        city:
          type: string
          minLength: 1
          nullable: true
        state:
          type: string
          minLength: 1
          nullable: true
        country:
          type: string
          minLength: 1
          nullable: true
        postal_code:
          type: string
          minLength: 1
          nullable: true
        email:
          type: string
          format: email
          nullable: true
        date_of_birth:
          type: string
          format: date
          nullable: true
        gender:
          type: string
          maxLength: 50
          nullable: true

    CustomerRead:
      allOf:
        - $ref: '#/components/schemas/CustomerCreate'
        - type: object
          properties:
            id:
              type: integer
            created_at:
              type: string
              format: date-time
            updated_at:
              type: string
              format: date-time

    CustomerList:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        contact_number:
          type: string
        city:
          type: string
        email:
          type: string
          nullable: true

    PaginatedCustomerList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/CustomerList'
        pagination:
          $ref: '#/components/schemas/PaginationMeta'

    # ===========================================================================
    # SUPPLIER SCHEMAS
    # ===========================================================================
    SupplierCreate:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
        contact_number:
          type: string
          maxLength: 20
          nullable: true
        email:
          type: string
          format: email
          nullable: true
        address:
          type: string
          nullable: true

    SupplierUpdate:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          nullable: true
        contact_number:
          type: string
          maxLength: 20
          nullable: true
        email:
          type: string
          format: email
          nullable: true
        address:
          type: string
          nullable: true

    SupplierRead:
      allOf:
        - $ref: '#/components/schemas/SupplierCreate'
        - type: object
          properties:
            id:
              type: integer
            created_at:
              type: string
              format: date-time
            updated_at:
              type: string
              format: date-time

    SupplierList:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        contact_number:
          type: string
          nullable: true
        email:
          type: string
          nullable: true

    PaginatedSupplierList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/SupplierList'
        pagination:
          $ref: '#/components/schemas/PaginationMeta'

    # ===========================================================================
    # BRAND SCHEMAS
    # ===========================================================================
    BrandCreate:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
        description:
          type: string
          nullable: true

    BrandUpdate:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          nullable: true
        description:
          type: string
          nullable: true

    BrandRead:
      allOf:
        - $ref: '#/components/schemas/BrandCreate'
        - type: object
          properties:
            id:
              type: integer
            created_at:
              type: string
              format: date-time
            updated_at:
              type: string
              format: date-time

    BrandList:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string

    PaginatedBrandList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/BrandList'
        pagination:
          $ref: '#/components/schemas/PaginationMeta'

    # ===========================================================================
    # JOB SCHEMAS
    # ===========================================================================
    JobStatus:
      type: string
      enum:
        - booked
        - indented
        - parts_received
        - completed
        - delivered
        - cancelled

    JobCreate:
      type: object
      required:
        - customer_id
      properties:
        customer_id:
          type: integer
          minimum: 1
        estimated_delivery_date:
          type: string
          format: date
          nullable: true
        notes:
          type: string
          nullable: true

    JobUpdate:
      type: object
      properties:
        estimated_cost:
          type: number
          format: decimal
          minimum: 0
          nullable: true
        estimated_parts_cost:
          type: number
          format: decimal
          minimum: 0
          nullable: true
        estimated_labour_cost:
          type: number
          format: decimal
          minimum: 0
          nullable: true
        deduction:
          type: number
          format: decimal
          minimum: 0
          nullable: true
        deduction_note:
          type: string
          nullable: true
        additional_charge:
          type: number
          format: decimal
          minimum: 0
          nullable: true
        additional_charge_note:
          type: string
          nullable: true
        actual_cost:
          type: number
          format: decimal
          minimum: 0
          nullable: true
        estimated_delivery_date:
          type: string
          format: date
          nullable: true
        notes:
          type: string
          nullable: true

    JobStatusUpdate:
      type: object
      required:
        - status
      properties:
        status:
          $ref: '#/components/schemas/JobStatus'
        notes:
          type: string
          nullable: true

    JobDelayCreate:
      type: object
      required:
        - delay_reason
        - new_estimated_delivery_date
      properties:
        delay_reason:
          type: string
          minLength: 1
        new_estimated_delivery_date:
          type: string
          format: date

    JobRead:
      type: object
      properties:
        id:
          type: integer
        job_number:
          type: string
        customer_id:
          type: integer
        estimated_cost:
          type: number
          format: decimal
          nullable: true
        estimated_parts_cost:
          type: number
          format: decimal
          nullable: true
        estimated_labour_cost:
          type: number
          format: decimal
          nullable: true
        deduction:
          type: number
          format: decimal
          nullable: true
        deduction_note:
          type: string
          nullable: true
        additional_charge:
          type: number
          format: decimal
          nullable: true
        additional_charge_note:
          type: string
          nullable: true
        actual_cost:
          type: number
          format: decimal
          nullable: true
        estimated_delivery_date:
          type: string
          format: date
          nullable: true
        notes:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/JobStatus'
        delay_reason:
          type: string
          nullable: true
        original_estimated_delivery_date:
          type: string
          format: date
          nullable: true
        delayed_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
          nullable: true
        delivered_at:
          type: string
          format: date-time
          nullable: true

    JobList:
      type: object
      properties:
        id:
          type: integer
        job_number:
          type: string
        customer_id:
          type: integer
        status:
          $ref: '#/components/schemas/JobStatus'
        estimated_cost:
          type: number
          format: decimal
          nullable: true
        estimated_delivery_date:
          type: string
          format: date
          nullable: true
        created_at:
          type: string
          format: date-time

    PaginatedJobList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/JobList'
        pagination:
          $ref: '#/components/schemas/PaginationMeta'

    # ===========================================================================
    # WATCH SCHEMAS
    # ===========================================================================
    WatchCreate:
      type: object
      required:
        - job_id
        - model_number
        - ucp_rate
      properties:
        job_id:
          type: integer
          minimum: 1
        brand_id:
          type: integer
          minimum: 1
          nullable: true
        model_number:
          type: string
          minLength: 1
          maxLength: 255
        watch_serial_number:
          type: string
          maxLength: 255
          nullable: true
        date_of_purchase:
          type: string
          format: date
          nullable: true
        ucp_rate:
          type: number
          format: decimal
          minimum: 0
        other_remarks:
          type: string
          nullable: true

    WatchUpdate:
      type: object
      properties:
        brand_id:
          type: integer
          minimum: 1
          nullable: true
        model_number:
          type: string
          minLength: 1
          maxLength: 255
          nullable: true
        watch_serial_number:
          type: string
          maxLength: 255
          nullable: true
        date_of_purchase:
          type: string
          format: date
          nullable: true
        ucp_rate:
          type: number
          format: decimal
          minimum: 0
          nullable: true
        other_remarks:
          type: string
          nullable: true

    WatchRead:
      type: object
      properties:
        id:
          type: integer
        job_id:
          type: integer
        brand_id:
          type: integer
          nullable: true
        model_number:
          type: string
        watch_serial_number:
          type: string
          nullable: true
        date_of_purchase:
          type: string
          format: date
          nullable: true
        ucp_rate:
          type: number
          format: decimal
        other_remarks:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    WatchList:
      type: object
      properties:
        id:
          type: integer
        job_id:
          type: integer
        brand_id:
          type: integer
          nullable: true
        model_number:
          type: string
        watch_serial_number:
          type: string
          nullable: true
        ucp_rate:
          type: number
          format: decimal

    PaginatedWatchList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/WatchList'
        pagination:
          $ref: '#/components/schemas/PaginationMeta'

    # ===========================================================================
    # INDENT SCHEMAS
    # ===========================================================================
    IndentCreate:
      type: object
      properties:
        job_id:
          type: integer
          minimum: 1
          nullable: true
        supplier_id:
          type: integer
          minimum: 1
          nullable: true
        notes:
          type: string
          nullable: true

    IndentUpdate:
      type: object
      properties:
        job_id:
          type: integer
          minimum: 1
          nullable: true
        supplier_id:
          type: integer
          minimum: 1
          nullable: true
        notes:
          type: string
          nullable: true

    IndentRead:
      type: object
      properties:
        id:
          type: integer
        serial_number:
          type: string
        job_id:
          type: integer
          nullable: true
        supplier_id:
          type: integer
          nullable: true
        notes:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    IndentList:
      type: object
      properties:
        id:
          type: integer
        serial_number:
          type: string
        job_id:
          type: integer
          nullable: true
        supplier_id:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time

    PaginatedIndentList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/IndentList'
        pagination:
          $ref: '#/components/schemas/PaginationMeta'

    # ===========================================================================
    # SPARE PART SCHEMAS
    # ===========================================================================
    SparePartCreate:
      type: object
      required:
        - indent_id
      properties:
        indent_id:
          type: integer
          minimum: 1
        part_name:
          type: string
          maxLength: 255
          nullable: true
        quantity:
          type: integer
          minimum: 0
          nullable: true

    SparePartUpdate:
      type: object
      properties:
        part_name:
          type: string
          maxLength: 255
          nullable: true
        quantity:
          type: integer
          minimum: 0
          nullable: true

    SparePartRead:
      type: object
      properties:
        id:
          type: integer
        indent_id:
          type: integer
        part_name:
          type: string
          nullable: true
        quantity:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    SparePartList:
      type: object
      properties:
        id:
          type: integer
        indent_id:
          type: integer
        part_name:
          type: string
          nullable: true
        quantity:
          type: integer
          nullable: true

    PaginatedSparePartList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/SparePartList'
        pagination:
          $ref: '#/components/schemas/PaginationMeta'

    # ===========================================================================
    # COMPLAINT/CONDITION SCHEMAS
    # ===========================================================================
    ComplaintNodeCreate:
      type: object
      required:
        - label
      properties:
        label:
          type: string
          minLength: 1
          maxLength: 500
        code:
          type: string
          maxLength: 100
          nullable: true
        parent_id:
          type: integer
          nullable: true
        sort_order:
          type: integer
          default: 0
        effective_from:
          type: string
          format: date
          nullable: true
        effective_to:
          type: string
          format: date
          nullable: true

    ComplaintNodeUpdate:
      type: object
      properties:
        label:
          type: string
          minLength: 1
          maxLength: 500
          nullable: true
        code:
          type: string
          maxLength: 100
          nullable: true
        parent_id:
          type: integer
          nullable: true
        sort_order:
          type: integer
          nullable: true
        effective_from:
          type: string
          format: date
          nullable: true
        effective_to:
          type: string
          format: date
          nullable: true

    ComplaintNodeRead:
      type: object
      properties:
        id:
          type: integer
        label:
          type: string
        code:
          type: string
          nullable: true
        parent_id:
          type: integer
          nullable: true
        sort_order:
          type: integer
        effective_from:
          type: string
          format: date
          nullable: true
        effective_to:
          type: string
          format: date
          nullable: true
        created_at:
          type: string
          format: date
        updated_at:
          type: string
          format: date
        deleted_at:
          type: string
          format: date
          nullable: true

    ComplaintNodeList:
      type: object
      properties:
        id:
          type: integer
        label:
          type: string
        code:
          type: string
          nullable: true
        parent_id:
          type: integer
          nullable: true
        sort_order:
          type: integer
        effective_from:
          type: string
          format: date
          nullable: true
        effective_to:
          type: string
          format: date
          nullable: true
        is_available:
          type: boolean
        children:
          type: array
          items:
            $ref: '#/components/schemas/ComplaintNodeList'

    ConditionNodeCreate:
      type: object
      required:
        - label
      properties:
        label:
          type: string
          minLength: 1
          maxLength: 500
        code:
          type: string
          maxLength: 100
          nullable: true
        parent_id:
          type: integer
          nullable: true
        sort_order:
          type: integer
          default: 0
        effective_from:
          type: string
          format: date
          nullable: true
        effective_to:
          type: string
          format: date
          nullable: true

    ConditionNodeUpdate:
      type: object
      properties:
        label:
          type: string
          minLength: 1
          maxLength: 500
          nullable: true
        code:
          type: string
          maxLength: 100
          nullable: true
        parent_id:
          type: integer
          nullable: true
        sort_order:
          type: integer
          nullable: true
        effective_from:
          type: string
          format: date
          nullable: true
        effective_to:
          type: string
          format: date
          nullable: true

    ConditionNodeRead:
      type: object
      properties:
        id:
          type: integer
        label:
          type: string
        code:
          type: string
          nullable: true
        parent_id:
          type: integer
          nullable: true
        sort_order:
          type: integer
        effective_from:
          type: string
          format: date
          nullable: true
        effective_to:
          type: string
          format: date
          nullable: true
        created_at:
          type: string
          format: date
        updated_at:
          type: string
          format: date
        deleted_at:
          type: string
          format: date
          nullable: true

    ConditionNodeList:
      type: object
      properties:
        id:
          type: integer
        label:
          type: string
        code:
          type: string
          nullable: true
        parent_id:
          type: integer
          nullable: true
        sort_order:
          type: integer
        effective_from:
          type: string
          format: date
          nullable: true
        effective_to:
          type: string
          format: date
          nullable: true
        is_available:
          type: boolean
        children:
          type: array
          items:
            $ref: '#/components/schemas/ConditionNodeList'

    WatchComplaintCreate:
      type: object
      required:
        - watch_id
        - complaint_node_id
      properties:
        watch_id:
          type: integer
        complaint_node_id:
          type: integer
        notes:
          type: string
          nullable: true

    WatchComplaintUpdate:
      type: object
      properties:
        notes:
          type: string
          nullable: true

    WatchComplaintRead:
      type: object
      properties:
        id:
          type: integer
        watch_id:
          type: integer
        complaint_node_id:
          type: integer
        notes:
          type: string
          nullable: true
        created_at:
          type: string
          format: date
        updated_at:
          type: string
          format: date
        complaint_node:
          $ref: '#/components/schemas/ComplaintNodeRead'

    WatchComplaintBatchCreate:
      type: object
      required:
        - watch_id
        - complaint_node_ids
      properties:
        watch_id:
          type: integer
        complaint_node_ids:
          type: array
          items:
            type: integer
          minItems: 1
        notes:
          type: string
          nullable: true

    WatchConditionCreate:
      type: object
      required:
        - watch_id
        - condition_node_id
      properties:
        watch_id:
          type: integer
        condition_node_id:
          type: integer
        notes:
          type: string
          nullable: true

    WatchConditionUpdate:
      type: object
      properties:
        notes:
          type: string
          nullable: true

    WatchConditionRead:
      type: object
      properties:
        id:
          type: integer
        watch_id:
          type: integer
        condition_node_id:
          type: integer
        notes:
          type: string
          nullable: true
        created_at:
          type: string
          format: date
        updated_at:
          type: string
          format: date
        condition_node:
          $ref: '#/components/schemas/ConditionNodeRead'

    WatchConditionBatchCreate:
      type: object
      required:
        - watch_id
        - condition_node_ids
      properties:
        watch_id:
          type: integer
        condition_node_ids:
          type: array
          items:
            type: integer
          minItems: 1
        notes:
          type: string
          nullable: true

    # ===========================================================================
    # ATTACHMENT SCHEMAS
    # ===========================================================================
    AttachmentUploadResponse:
      type: object
      properties:
        id:
          type: integer
        file_name:
          type: string
        mime_type:
          type: string
          nullable: true
        file_size_bytes:
          type: integer
          nullable: true
        storage_path:
          type: string
        created_at:
          type: string
          format: date-time
        message:
          type: string
          default: File uploaded successfully

    WatchAttachmentRead:
      type: object
      properties:
        id:
          type: integer
        watch_id:
          type: integer
        file_name:
          type: string
        mime_type:
          type: string
          nullable: true
        file_size_bytes:
          type: integer
          nullable: true
        storage_path:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    WatchAttachmentList:
      type: object
      properties:
        id:
          type: integer
        watch_id:
          type: integer
        file_name:
          type: string
        mime_type:
          type: string
          nullable: true
        file_size_bytes:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time

    WatchComplaintAttachmentRead:
      type: object
      properties:
        id:
          type: integer
        watch_complaint_id:
          type: integer
        file_name:
          type: string
        mime_type:
          type: string
          nullable: true
        file_size_bytes:
          type: integer
          nullable: true
        storage_path:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    WatchComplaintAttachmentList:
      type: object
      properties:
        id:
          type: integer
        watch_complaint_id:
          type: integer
        file_name:
          type: string
        mime_type:
          type: string
          nullable: true
        file_size_bytes:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time

    WatchConditionAttachmentRead:
      type: object
      properties:
        id:
          type: integer
        watch_condition_id:
          type: integer
        file_name:
          type: string
        mime_type:
          type: string
          nullable: true
        file_size_bytes:
          type: integer
          nullable: true
        storage_path:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    WatchConditionAttachmentList:
      type: object
      properties:
        id:
          type: integer
        watch_condition_id:
          type: integer
        file_name:
          type: string
        mime_type:
          type: string
          nullable: true
        file_size_bytes:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time

    # ===========================================================================
    # AUDIT SCHEMAS
    # ===========================================================================
    AuditEvent:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
          nullable: true
        entity_type:
          type: string
        entity_id:
          type: integer
        action:
          type: string
          enum: [create, update, delete, status_change, login, logout, restore, export, import]
        changes:
          type: object
          additionalProperties: true
          nullable: true
        created_at:
          type: string
          format: date-time

    # ===========================================================================
    # SEARCH SCHEMAS
    # ===========================================================================
    SearchResult:
      type: object
      properties:
        entity_type:
          type: string
          enum: [customer, job, watch, supplier, brand]
        entity_id:
          type: integer
        title:
          type: string
        subtitle:
          type: string
        description:
          type: string
          nullable: true
        relevance_score:
          type: number
          minimum: 0
          maximum: 1
        matched_fields:
          type: array
          items:
            type: string
        created_at:
          type: string
          format: date-time

    SearchResponse:
      type: object
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/SearchResult'
        total:
          type: integer
        query:
          type: string
        entities_searched:
          type: array
          items:
            type: string
            enum: [customer, job, watch, supplier, brand]
        pagination:
          type: object
          properties:
            page:
              type: integer
            page_size:
              type: integer
            total:
              type: integer
            total_pages:
              type: integer
            has_next:
              type: boolean
            has_previous:
              type: boolean

    # ===========================================================================
    # COMMON SCHEMAS
    # ===========================================================================
    PaginationMeta:
      type: object
      properties:
        page:
          type: integer
          description: Current page number
        page_size:
          type: integer
          description: Items per page
        total:
          type: integer
          description: Total number of items
        total_pages:
          type: integer
          description: Total number of pages
        has_next:
          type: boolean
          description: Whether there is a next page
        has_previous:
          type: boolean
          description: Whether there is a previous page

    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              description: Error code
            message:
              type: string
              description: Human-readable error message
            details:
              type: array
              items:
                type: object
                properties:
                  field:
                    type: string
                  message:
                    type: string
            request_id:
              type: string
              description: Request ID for debugging
